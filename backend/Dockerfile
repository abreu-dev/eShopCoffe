#See https://aka.ms/containerfastmode to understand how Visual Studio uses this Dockerfile to build your images for faster debugging.

FROM mcr.microsoft.com/dotnet/sdk:6.0 as build

WORKDIR /app
COPY backend .
RUN dotnet restore
RUN dotnet publish -o /app/published-app

FROM mcr.microsoft.com/dotnet/aspnet:6.0 as runtime
WORKDIR /app
COPY --from=build /app/published-app /app

ARG DATABASE_SERVER=${DATABASE_SERVER}
ENV DATABASE_SERVER=${DATABASE_SERVER}

ARG DATABASE_NAME=${DATABASE_NAME}
ENV DATABASE_NAME=${DATABASE_NAME}

ARG DATABASE_USER=${DATABASE_USER}
ENV DATABASE_USER=${DATABASE_USER}

ARG DATABASE_PASSWORD=${DATABASE_PASSWORD}
ENV DATABASE_PASSWORD=${DATABASE_PASSWORD}

ARG JWT_SECRET=${JWT_SECRET}
ENV JWT_SECRET=${JWT_SECRET}

ARG JWT_EXPIRES=${JWT_EXPIRES}
ENV JWT_EXPIRES=${JWT_EXPIRES}

ARG EMAIL_HOST=${EMAIL_HOST}
ENV EMAIL_HOST=${EMAIL_HOST}

ARG EMAIL_PORT=${EMAIL_PORT}
ENV EMAIL_PORT=${EMAIL_PORT}

ARG EMAIL_ADDRESS=${EMAIL_ADDRESS}
ENV EMAIL_ADDRESS=${EMAIL_ADDRESS}

ARG EMAIL_PASSWORD=${EMAIL_PASSWORD}
ENV EMAIL_PASSWORD=${EMAIL_PASSWORD}

ENTRYPOINT [ "dotnet", "/app/eShopCoffe.API.dll" ]